---
alwaysApply: true
---

# 项目总览

- **框架**：Vite + React 18，TypeScript 严格模式。
- **UI**：React 18 + Ant Design 6，Tailwind CSS 4 做样式，`@/styles` 放共享样式。
- **路由**：React Router 7，基于文件的路由系统（`vite-fs-router-plugin`），页面位于 `src/pages`。
- **国际化**：基于 react-i18next，语言资源位于 `src/locales/resource`。
- **状态与数据**：Zustand 管全局状态，SWR 处理客户端数据，Axios 做 HTTP，Zod 做数据验证和类型推断。
- **工具链**：pnpm、ESLint 9、Prettier（含 sort-imports、tailwind 插件）、Tailwind 4（通过 `@tailwindcss/vite`）。
- **路径别名**：`@/* -> src/*`，请优先使用别名。

# 目录速览

```
src/
├─ components/   # 通用组件
├─ hooks/        # 自定义 hooks
├─ lib/          # 第三方封装（Provider、路由创建等）
├─ locales/      # react-i18next 配置与语言资源
├─ pages/        # 基于文件的路由页面
├─ styles/       # 样式与常量
├─ types/        # 类型声明
└─ utils/        # 工具函数
```

# 常用脚本

| 命令                 | 说明                            |
| -------------------- | ------------------------------- |
| `pnpm dev`           | 开发调试（`vite`）              |
| `pnpm build`         | 正常构建                        |
| `pnpm build:analyze` | `--mode analyze` 开启 bundle 分析 |
| `pnpm preview`       | 预览构建产物                    |
| `pnpm prettier`      | `prettier --write src/`         |
| `pnpm lint`          | ESLint 检查                     |

> `vite.config.ts` 配置了 bundle analyzer，通过 `--mode analyze` 启用。

# 全局类型

## @/types/index.d.ts

定义全局辅助类型，包括：

- `Style`：样式相关的 props（如 `className`、`style` 等），用于组件 Props 类型定义。
- `isFunction`：判断是否为函数的类型守卫。
- `ActionType<ActionMap>`：将键值对映射转换为可辨识联合类型（discriminated union），适用于函数需要根据不同类型执行不同操作的场景。
  - 转换规则：
    - 将 `{ a: number; b: undefined; c?: number }` 转换为 `{ type: 'a'; value: number } | { type: 'b'; value?: undefined } | { type: 'c'; value?: number }`
    - 必填且非 `undefined` 的键：生成 `{ type: K; value: ActionMap[K] }`
    - 值为 `undefined` 的键：生成 `{ type: K; value?: undefined }`（`value` 可选但类型为 `undefined`，实际使用时可忽略）
    - 可选键（`c?: number`）：生成 `{ type: K; value?: ActionMap[K] }`
    - 函数可通过 `action.type` 进行类型收窄，TypeScript 会自动推断对应的 `value` 类型

## @/types/css.d.ts

处理样式模块导入的类型声明。

## @/types/ValueController/index.ts

声明同名自定义模块 `value-controller`：

- `ValueController` 是一个泛型工具，用来描述 `{ value, onChange }` 控制器的多种变体，可通过 `strictValue` 控制 `value` 是否必填、`strictOnChange` 控制 `onChange` 是否必填、`strictOnChangeArg` 控制参数是否可选、`updater` 控制是否支持函数式更新。
- `ValueObj`、`OnChangeObj`、`OnChange`、`OnChangeArg`、`Updater` 等类型围绕这些开关派生具体形态，便于组件精准建模受控/半受控/非受控场景。
- 该模块完全自定义，不依赖第三方库，引用时 `import type { ValueController } from 'value-controller'`。

新增类型请集中到 `@/types`。

# 工具函数与库

## @/utils/index

汇总通用的工具函数：

- `cn`：使用 `clsx + tailwind-merge` 合并 `className`。
- `sleep`：基于 Promise 的延时，在示例页用于模拟异步。
- `withSuspense`：为任意组件或 ReactNode 添加 Suspense 边界。
- `withErrorBoundary`：基于 `react-error-boundary`，为组件或 ReactNode 增加错误边界。
- `loadFile`：在浏览器中以函数形式加载文件。
- `Rxjs/*`：导出 RxJS 相关辅助。
- `isReactNode`：判断某个值是否为有效的 ReactNode。

## @/lib

存放全局注入、一次性初始化或 layout 级别使用的封装（如主题、注册器、Provider、路由创建等）。正常业务页面/组件应调用 `@/utils` 或具体模块，避免滥用 `@/lib`。

## Zod

项目使用 Zod 进行数据验证和类型推断：

- **数据验证**：在 API 请求处理、表单提交等场景中使用 Zod Schema 验证输入数据，确保数据符合预期格式。
- **类型推断**：通过 `z.infer<typeof schema>` 从 Zod Schema 推断 TypeScript 类型，实现运行时验证与编译时类型的统一。
- **常用场景**：
  - API 请求/响应数据验证
  - 表单数据验证
  - 组件 Props 验证

# Hooks

所有自定义 hooks 位于 `@/hooks` 并在 `index.tsx` 聚合导出：

- `useImmediateEffect`：在依赖变更后同步执行 effect，适合与受控值同步。
- `useSemiControlledValue`：辅助实现受控/非受控双模态组件，与 `ValueController` 类型配套。
- `useComposition`：处理输入法组合事件（CompositionEvent），确保输入法合成期间不触发 onChange。如需防抖，只需将传入的 `onChange` 包装为防抖函数（如使用 `ahooks` 的 `useDebounceFn`）即可，hook 会自动处理合成与防抖的协调。

# 样式系统

- `@/styles/tailwind.css` 汇总 Tailwind、Ant Design reset 及项目自定义全局样式。
- `@/styles/index.ts` 导出如 `AbsoluteCenter` 这类常用 className 常量，可在组件中引用。
- 项目使用 Tailwind CSS 4 作为主要样式方案，配合 CSS Modules 处理复杂样式。
- 不使用 Sass/Less；全部样式以原生 CSS、CSS Modules 或 Tailwind 为主。

# 参考

- 如需补充规范，允许联网查阅 Vite、React Router、react-i18next、Ant Design 等官方文档或权威资料，确保内容与最新版本保持一致。
